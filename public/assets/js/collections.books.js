!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=44)}({"3MGB":function(e,t,n){"use strict";function a(e){this.parent=e;var t=this;this.init=function(){var e=t.parent;t.list=e.find(".list"),t.form=e.find("form"),t.defineInfinityPagination(),t.form.formChange({timeout:500,onShow:function(){$(this).ajaxSubmit({beforeSubmit:function(e,n,a){return t.list.addClass("loading-cap"),e=$.grep(e,(function(e){return""!=e.value})),history.pushState("","",n.attr("action")+"?"+$.param(e)),!0},success:function(e,n,a,i){t.list.removeClass("loading-cap"),t.list.html(e),t.defineInfinityPagination(),t.on_list_ready()},error:function(e,t,n,a){401==e.status&&location.reload()}})}}),t.on_list_ready(),t.genres(),t.and_genres(),t.exclude_genres(),t.awards(),t.keywords(),t.language(),t.original_language(),t.formats(),t.order(),t.bindSaveFields()},this.onLoadUrl=function(e){t.list.addClass("loading-cap"),window.history.pushState("","",e),$.ajax({url:e,data:{ajax:!0}}).done((function(e){t.list.removeClass("loading-cap"),t.list.html(e),t.on_list_ready(),$("html, body").animate({scrollTop:t.list.offset().top-80},100)})).fail((function(){401==jqXHR.status&&location.reload()}))},this.defineInfinityPagination=function(){t.list.off("click",".pagination a").on("click",".pagination a",(function(e){e.preventDefault(),t.list.addClass("loading-cap");var n=$(this).attr("href");t.onLoadUrl(n)})),t.list.off("click",".view a").on("click",".view a",(function(e){e.preventDefault();var n=$(this).attr("href");t.onLoadUrl(n)}))},this.order=function(){t.form.find(".order").select2({width:"100%",placeholder:$(this).data("placeholder")})},this.language=function(){t.form.find(".language").select2({width:"100%",placeholder:$(this).data("placeholder")})},this.original_language=function(){t.form.find(".original_lang").select2({width:"100%",placeholder:$(this).data("placeholder")})},this.formats=function(){t.form.find(".formats").select2({width:"100%",placeholder:$(this).data("placeholder")})},this.genres=function(){$("#selected_genres_button").first();var e=$("#selected_genres_modal").first(),n=$(".genres"),a=e.find(".container-fluid").first();t.selectGenre(n,e,a)},this.and_genres=function(){$("#and_selected_genres_button").first();var e=$("#and_selected_genres_modal").first(),n=$(".and_genres"),a=e.find(".container-fluid").first();t.selectGenre(n,e,a)},this.exclude_genres=function(){$("#excluded_genres_button").first();var e=$("#excluded_genres_modal").first(),n=$(".exclude-genres"),a=e.find(".container-fluid").first();t.selectGenre(n,e,a)},this.keywords=function(){t.form.find(".keywords").select2({width:"100%",placeholder:$(this).data("placeholder"),tags:!0,tokenSeparators:[","],maximumSelectionLength:0,ajax:{url:"/keywords/search",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){t.page=t.page||1;for(var n=[],a=0;a<e.data.length;a++)n[a]=e.data[a],n[a].id=n[a].text;return{results:n,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:2,templateResult:function(e){if(e.loading)return e.text;var t="";return t+="<div >",t+=e.text,t+=" </div>"},templateSelection:function(e){return e.keyword,e.text},createTag:function(e){}})},this.on_list_ready=function(){window.paginationScrollToActive(),this.list.find(".book").each((function(){!function(e){var t=parseInt(e.data("id"));e.onUpdate=function(){},function(){var n=e.find(".chose").first(),a=localStorage.getObj("selected_books");null==a&&(a=[]);a.indexOf(t)>-1&&n.addClass("active").attr("aria-pressed","true");n.unbind("click").on("click",(function(){event.preventDefault();var a=localStorage.getObj("selected_books");if(n.hasClass("active")){n.removeClass("active").attr("aria-pressed","false");var i=a.indexOf(t);-1!=i&&a.splice(i,1),localStorage.setObj("selected_books",$.unique(a)),e.onUpdate(a)}else n.addClass("active").attr("aria-pressed","true"),a.push(t),localStorage.setObj("selected_books",$.unique(a)),e.onUpdate(a)}))}()}($(this))}))},this.bindSaveFields=function(){t.form.find(".save").each((function(){var e=$(this);(e.is("select")||"checkbox"===e.attr("type"))&&e.bind("change",(function(){t.saveInputValue(e)}))}))},this.saveInputValue=function(e){var t=e.attr("name"),n=e.val();$.ajax({url:"/books/search/settings/store",data:{name:t,value:n}}).done((function(t){e.addClass("is-valid")})).fail((function(){e.addClass("is-invalid")}))},this.awards=function(){t.form.find(".award").select2({placeholder:$(this).data("placeholder"),width:"100%",allowClear:!0,ajax:{url:"/awards",dataType:"json",delay:100,data:function(e){return{search:e.term,page:e.page||1}},processResults:function(e,t){t.page=t.page||1;for(var n=[],a=0;a<e.data.length;a++)n[a]=e.data[a],n[a].id=n[a].title;return{results:n,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:function(e){if(e.loading)return e.text;var t="";return t+="<div >",t+=e.title,t+="</div>"},templateSelection:function(e){return e.title||e.text}})},this.selectGenre=function(e,t,n){e.select2({width:"100%",placeholder:$(this).data("placeholder"),ajax:{url:"/genres/search?limit=100",dataType:"json",delay:100,placeholder:$(this).data("placeholder"),data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){return t.page=t.page||1,{results:e.data,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:function(e){if(e.loading)return e.text;var t="";return t+="<div>",t+=e.name,t+="</div>"},templateSelection:function(e){return e.name||e.text}}),t.on("show.bs.modal",(function(a){n.addClass("loading-cap"),$.ajax({url:"/genres/select_list"}).done((function(a){t.data("loaded","true"),n.removeClass("loading-cap"),n.html(a),e.val().forEach((function(e){n.find("[data-type=genre][data-id="+e+"]").prop("checked",!0)})),n.find("[data-type=genre_group]").unbind("click").click((function(){n.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]:checked").length?n.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]").each((function(e){$(this).prop("checked",!1)})):n.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]").each((function(e){$(this).prop("checked",!0)}))}))})).fail((function(){401==jqXHR.status&&location.reload()}))})),t.on("hidden.bs.modal",(function(t){e.html(""),n.find("[data-type=genre]").each((function(){if($(this).is(":checked")){var t=$(this).data("id");e.append('<option value="'+t+'" selected="selected">'+n.find("[for="+$(this).attr("id")+"]").text()+"</option>")}})),e.trigger("change")}))}}n.d(t,"a",(function(){return a}))},44:function(e,t,n){e.exports=n("wYav")},wYav:function(e,t,n){"use strict";n.r(t);var a=new(n("3MGB").a)($(".books-search-container").first());a.on_list_ready=function(){window.paginationScrollToActive(),this.list.find("[data-id]").each((function(){var e=$(this);e.find(".detach").unbind("click").on("click",(function(t){t.preventDefault();var n=$(this).attr("href");$.ajax({url:n}).done((function(t){e.addClass("loading-cap")})).fail((function(){}))}))}))},a.init()}});