!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=16)}({16:function(e,t,a){e.exports=a("8afj")},"8afj":function(e,t,a){"use strict";function n(e){var t=e.next(".select2-container").find("ul.select2-selection__rendered");t.sortable({handle:".move",onDrop:function(a,n,i){var r=$("<div/>").css({height:0});a.before(r),r.animate({height:a.height()}),a.animate(r.position(),(function(){r.detach(),i(a,n)})),$($(t).find(".select2-selection__choice").get().reverse()).each((function(){var t=$(this).data("data").id,a=e.find('option[value="'+t+'"]')[0];e.prepend(a)}))}})}a.r(t),$(".author-select").each((function(){n($(this).select2({width:"100%",tags:!0,placeholder:$(this).data("placeholder"),ajax:{url:"/authors/search",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){return t.page=t.page||1,{results:e.data,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:function(e){if(e.loading)return e.text;var t="";return e.newTag?t+=e.text+" - Добавить нового автора":(t+="<div >",t+=e.fullName,t+=" ID: "+e.id,t+=" </div>"),t},templateSelection:function(e){if(e.id.match(/[0-9]+/i)){var t='<a href="/authors/'+e.id+'" target="_blank">';return e.fullName&&(t+=e.fullName),e.text&&(t+=e.text),t+="</a> ID: "+e.id,t+=' <i class="move fas fa-arrows-alt text-black-50"></i> '}return e.text},createTag:function(e){}}))}));var i=$(".genres").first();i.select2({width:"100%",tags:!0,placeholder:$(void 0).data("placeholder"),ajax:{url:"/genres/search?limit=100",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){return t.page=t.page||1,{results:e.data,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:0,templateResult:function(e){if(e.loading)return e.text;var t="";return t+="<div >",t+=e.group.name,t+=' <i class="fas fa-angle-right"></i> ',t+=e.name,t+=" ID: "+e.id,t+="</div>"},templateSelection:function(e){if(e.id.match(/[0-9]+/i)){var t='<a href="/books?genre='+e.id+'" target="_blank">';return t+=e.text||e.name,t+="</a> ID: "+e.id,t+=' <i class="move fas fa-arrows-alt text-black-50"></i> '}return e.text},createTag:function(e){}}),n(i);var r=$(".sequences-list");function o(){r.find(".item").each((function(){var e=$(this);e.find(".delete").unbind().click((function(){e.remove()}))}))}o();var d=$(".sequence-select");if(d.length){var u=d.find("select");u.select2({width:"100%",tags:!0,placeholder:$(void 0).data("placeholder"),ajax:{url:"/sequences/search",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){return t.page=t.page||1,{results:e.data,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:function(e){if(e.loading)return e.text;var t="";return e.newTag?t+=e.text:(t+="<div >",t+=e.name,t+=" ID: "+e.id,t+="</div>"),t},templateSelection:function(e){if(e.id.match(/[0-9]+/i)){var t='<a href="/sequences/'+e.id+'" target="_blank">';return e.name&&(t+=e.name),e.text&&(t+=e.text),t+="</a> ID: "+e.id}return e.text},createTag:function(e){}}),d.find(".add").click((function(){var e=u.val();e&&$.ajax({method:"GET",url:"/sequences/"+e+"/book_edit",dataType:"html"}).done((function(e){r.append(e),u.val("").trigger("change"),o()}))}))}r.sortable({handle:".move",itemSelector:".item",group:"sequences-list",pullPlaceholder:!0,onDrop:function(e,t,a){var n=$("<div/>").css({height:0});e.before(n),n.animate({height:e.height()}),e.animate(n.position(),(function(){n.detach(),a(e,t)}))}});var c=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/storage/typeahead/book/publishers.json"});$("#pi_pub").typeahead(null,{name:"best-pictures",display:"value",hint:!0,highlight:!0,minLength:2,source:c});var l=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/storage/typeahead/book/cities.json"});$("#pi_city").typeahead(null,{name:"best-pictures",display:"value",hint:!0,highlight:!0,minLength:2,source:l});var s=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"/storage/typeahead/book/rightholders.json"});$("#rightholder").typeahead(null,{name:"best-pictures",display:"value",hint:!0,highlight:!0,minLength:2,source:s}),$("#ti_lb").select2({width:"100%"}),$("#ti_olb").select2({width:"100%"});$("#selected_genres_button");var p=$("#selected_genres_modal"),h=p.find(".container-fluid"),f=$(".genres");function g(){f.val().forEach((function(e){h.find("[data-type=genre][data-id="+e+"]").prop("checked",!0)})),h.find("[data-type=genre_group]").unbind("click").click((function(){h.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]:checked").length?h.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]").each((function(e){$(this).prop("checked",!1)})):h.find("[data-type=genre][data-parent-id="+$(this).data("id")+"]").each((function(e){$(this).prop("checked",!0)}))}))}p.on("show.bs.modal",(function(e){p.data("loaded")?g():(h.addClass("loading-cap"),$.ajax({url:"/genres/select_list"}).done((function(e){p.data("loaded","true"),h.removeClass("loading-cap"),h.html(e),g()})).fail((function(){401==jqXHR.status&&location.reload()})))})),p.on("hidden.bs.modal",(function(e){f.html(""),h.find("[data-type=genre]").each((function(){if($(this).is(":checked")){var e=$(this).data("id");f.append('<option value="'+e+'" selected="selected">'+h.find("[for="+$(this).attr("id")+"]").text()+"</option>")}})),f.trigger("change")})),$("#keywords").first().select2({width:"style",placeholder:$(void 0).data("placeholder"),tags:!0,tokenSeparators:[","],maximumSelectionLength:0,ajax:{url:"/keywords/search",dataType:"json",delay:100,data:function(e){return{q:e.term,page:e.page||1}},processResults:function(e,t){t.page=t.page||1;for(var a=[],n=0;n<e.data.length;n++)a[n]=e.data[n],a[n].id=a[n].text;return{results:a,pagination:{more:!!e.next_page_url}}},cache:!0},escapeMarkup:function(e){return e},templateResult:function(e){if(e.loading)return e.text;var t="";return e.text?(t+="<div >",t+=e.text,t+=" </div>"):(t+="<div >",t+=e.keyword.text,t+=" </div>"),t},templateSelection:function(e){return e.keyword?e.keyword.text:e.text},createTag:function(e){}})}});